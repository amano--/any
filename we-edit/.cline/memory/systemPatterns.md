# システムパターン

## アーキテクチャパターン

### レイヤードアーキテクチャ
1. プレゼンテーション層
   - Next.js App Router
   - shadcn/uiコンポーネント
   - Zustand状態管理
   - next-intl多言語対応

2. APIレイヤー
   - tRPCルーター
   - 型安全なエンドポイント
   - バリデーション

3. データアクセス層
   - Repositoryパターン
   - Drizzle ORM
   - マイグレーション管理

## デザインパターン

### コンポーネント設計
1. Atomic Design
   - TreeContainer (Container)
   - TreeItem (Presentational)
   - 共通スタイル定義

2. Adapterパターン
   - Chrome互換データ変換
   - API通信抽象化

3. Repository
   - データアクセスの抽象化
   - テスト容易性の向上

### 多言語対応パターン
1. リソース分離
   - 言語ごとのファイル分割
   - 階層化された翻訳キー
   - 型安全なアクセス

2. フォールバック
   - デフォルト言語設定
   - 未翻訳時の代替テキスト
   - エラーハンドリング

3. 動的ローディング
   - 言語リソースの遅延読み込み
   - キャッシュ戦略
   - バンドルサイズ最適化

## データモデリング

### 階層構造
1. Adjacency List
   - parent_id参照
   - position順序付け
   - 深さ制限

2. バリデーション
   - 循環参照チェック
   - 重複名防止
   - 最大深さ制限

## 状態管理

### Zustandパターン
1. グローバル状態
   - ツリー構造
   - 選択状態
   - UI状態
   - 言語設定

2. 永続化
   - ローカルストレージ
   - セッション管理
   - 言語設定の保存

## テストパターン

### テスト戦略
1. ユニットテスト
   - コンポーネント単体
   - ユーティリティ関数
   - バリデーション

2. インテグレーション
   - APIエンドポイント
   - データフロー
   - 状態管理

3. UI/UXテスト
   - Storybookシナリオ
   - インタラクション
   - アクセシビリティ
   - 多言語表示

## セキュリティパターン

### 認証・認可
1. NextAuth
   - セッション管理
   - ルート保護
   - API認証

2. バリデーション
   - 入力検証
   - APIペイロード
   - クロスサイトスクリプティング対策

## 最適化パターン

### パフォーマンス
1. キャッシング
   - APIレスポンス
   - 静的アセット
   - 状態永続化
   - 言語リソース

2. レンダリング
   - 仮想化リスト
   - 遅延ロード
   - メモ化
   - 翻訳の最適化
