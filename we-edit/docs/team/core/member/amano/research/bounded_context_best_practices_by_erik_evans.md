# 境界付けられたコンテキスト（Bounded Context） - エリック・エバンスによる解説

## 1. はじめに - ドメイン駆動設計の核心

ドメイン駆動設計（DDD）は、ソフトウェア開発において、ビジネスドメイン（問題領域）を深く理解し、それをソフトウェアの構造に反映させることを目指すアプローチです。その中心となる概念が、境界付けられたコンテキスト（Bounded Context）です。これは、複雑なドメインを理解しやすく、管理しやすくするための、最も重要な戦略の一つと言えるでしょう。

## 2. 境界付けられたコンテキストの定義 - モデルの有効範囲

境界付けられたコンテキストとは、特定のビジネス能力（サブドメイン）を表現する、一貫性のあるモデル（ユビキタス言語）が適用される、システムの特定の領域のことです。これは、単なるコードの塊ではなく、ビジネスの特定の側面を表現する、明確に定義されたモデルの有効範囲を意味します。

*   **サブドメイン:** 複雑なドメインを、より小さな、独立したビジネス能力に分割したものです。
    *   例: 顧客管理、注文管理、在庫管理
*   **モデル（ユビキタス言語）:** サブドメインを表現するための、共通の言語と概念です。
    *   例: 顧客、注文、商品、在庫
*   **境界:** 各コンテキストの境界を明確に定義し、コンテキスト間の依存関係を管理します。
    *   例: 顧客管理コンテキストと注文管理コンテキストの境界

## 3. なぜ境界付けられたコンテキストが必要なのか - 複雑さの克服

ソフトウェア開発における最大の課題の一つは、複雑さの管理です。ビジネスドメインは、往々にして非常に複雑であり、その複雑さがソフトウェアの構造に反映されると、理解しにくく、変更が困難なシステムになってしまいます。境界付けられたコンテキストは、この複雑さを克服するための強力なツールです。

*   **複雑さの管理:** 複雑なドメインを、より小さな、管理しやすいサブドメインに分割します。各サブドメインは、独立したモデルを持つため、全体的な複雑さを軽減できます。
*   **チーム間のコミュニケーションの円滑化:** 各コンテキストに特化したユビキタス言語を使用することで、チーム間のコミュニケーションを円滑にします。異なるコンテキストのチームは、それぞれのコンテキストに特化した専門用語を使用し、誤解を防ぐことができます。
*   **変更の影響範囲の限定:** 各コンテキストは独立しているため、あるコンテキストの変更が他のコンテキストに与える影響を限定できます。これにより、変更のリスクを低減し、開発の速度を向上させることができます。
*   **技術的な独立性の確保:** 各コンテキストは、異なる技術スタックや実装方法を使用することができます。これにより、最適な技術を選択し、柔軟なシステムを構築できます。

## 4. 境界付けられたコンテキストの設計 - ドメインの分割とモデルの定義

境界付けられたコンテキストを設計する際には、以下の点を考慮します。

### 4.1 サブドメインの特定 - ビジネス能力の分析

*   **ビジネス能力の分析:** ビジネスの主要な能力を分析し、サブドメインを特定します。
    *   例: 顧客管理、注文管理、在庫管理、会計
*   **ユビキタス言語の特定:** 各サブドメインに特化したユビキタス言語を特定します。
    *   例: 顧客管理コンテキストでは、顧客、アカウント、連絡先などの用語を使用する。
*   **コンテキスト間の関係の分析:** サブドメイン間の関係を分析します。
    *   例: 顧客管理コンテキストと注文管理コンテキストは、顧客という概念を共有している。

### 4.2 コンテキストの境界の定義 - モデルの分離

*   **明確な境界の定義:** 各コンテキストの境界を明確に定義します。
    *   例: 顧客管理コンテキストは、顧客に関する情報のみを扱う。
*   **コンテキスト間の依存関係の管理:** コンテキスト間の依存関係を明確にし、管理します。
    *   例: 注文管理コンテキストは、顧客管理コンテキストの顧客情報を参照する。
*   **コンテキスト間のデータの変換:** コンテキスト間でデータを連携する際には、データの変換を行います。
    *   例: 顧客管理コンテキストと注文管理コンテキストで、顧客の表現方法が異なる場合、データの変換を行う。

### 4.3 設計パターン - コンテキスト間の連携

*   **共有カーネル（Shared Kernel）:** 複数のコンテキストで共有されるモデルやコードを定義します。
    *   例: 顧客の住所情報など、複数のコンテキストで共通して使用される情報。
*   **顧客とサプライヤー（Customer-Supplier）:** あるコンテキストが、別のコンテキストのサービスを利用する関係を定義します。
    *   例: 注文管理コンテキストが、顧客管理コンテキストの顧客情報を利用する。
*   **コンフォーミスト（Conformist）:** あるコンテキストが、別のコンテキストのモデルに完全に準拠します。
    *   例: 複数のコンテキストで、同じ顧客モデルを使用する。
*   **アンチ腐敗層（Anti-Corruption Layer）:** 外部システムとの連携において、自社のモデルを保護するための層を定義します。
    *   例: 外部の顧客管理システムとの連携において、自社の顧客モデルを保護するための層を定義する。
*   **分離されたコンテキスト（Separate Ways）:** コンテキスト間の連携を完全に分離します。
    *   例: 顧客管理コンテキストと会計コンテキストは、完全に独立している。

## 5. 境界付けられたコンテキストの実装 - 独立したモデルと技術

### 5.1 技術スタックの選択 - 各コンテキストに最適な技術

*   **各コンテキストに最適な技術スタックを選択します。**
    *   例: あるコンテキストには、マイクロサービスアーキテクチャを採用し、別のコンテキストには、モノリシックアーキテクチャを採用する。
*   **コンテキスト間の連携には、API を使用します。**
    *   例: REST API、gRPC

### 5.2 データモデリング - 各コンテキストに特化したモデル

*   **各コンテキストに特化したデータモデルを設計します。**
*   **コンテキスト間でデータを連携する際には、データの変換を行います。**
    *   例: 各コンテキストで、異なるデータ形式を使用する。

### 5.3 チーム編成 - 独立したチームとコミュニケーション

*   **各コンテキストに、独立したチームを割り当てます。**
*   **チーム間のコミュニケーションを円滑にするための仕組みを構築します。**
    *   例: 定期的な会議、ドキュメントの共有

### 5.4 テスト - 各コンテキストの独立性と連携

*   **各コンテキストを独立してテストします。**
*   **コンテキスト間の連携をテストします。**
    *   例: インテグレーションテスト

## 6. ベストプラクティス - 成功のための指針

*   **ドメインエキスパートとの連携:** ドメインエキスパートと協力して、サブドメインを特定し、ユビキタス言語を定義します。
*   **継続的な改善:** 境界付けられたコンテキストの設計は、継続的に改善します。
*   **シンプルな設計:** 複雑すぎる設計は避け、シンプルな設計を心がけます。
*   **コンテキスト間の依存関係の最小化:** コンテキスト間の依存関係を最小限に抑えます。
*   **ドキュメントの作成:** 境界付けられたコンテキストの設計、実装、および連携に関するドキュメントを作成します。
*   **コードの分離:** 各コンテキストのコードを明確に分離し、他のコンテキストへの影響を最小限に抑えます。
*   **イベント駆動アーキテクチャの活用:** コンテキスト間の連携に、イベント駆動アーキテクチャを活用することで、疎結合なシステムを構築できます。

## 7. まとめ - DDD の成功の鍵

境界付けられたコンテキストは、ドメイン駆動設計における最も重要な概念の一つです。この概念を理解し、適切に適用することで、複雑なビジネスドメインを効果的にモデル化し、高品質なソフトウェアを開発することができます。境界付けられたコンテキストの設計と実装は、DDD の成功の鍵と言えるでしょう。