# Roo特化型プロンプトエンジニアリングのベストプラクティス

## 1. モード活用の最適化

### 1.1 適切なモードの選択

Roo を使用する際には、タスクの種類に応じて適切なモードを選択することが重要です。各モードには、特定のタスクに特化した機能と役割が割り当てられています。

*   **Code Mode**: コーディングや実装タスクに最適です。コードの記述、修正、リファクタリングなど、コードに関する作業を行う際に使用します。
    ```markdown
    例: "TypeScript で、React のカスタムフックを実装して、指定された API からデータを取得し、エラーハンドリングを行うようにしてください。"
    ```

*   **Architect Mode**: プロジェクトの設計や構造化に関するタスクに最適です。システムのアーキテクチャ、ディレクトリ構造、モジュール間の依存関係などを検討する際に使用します。
    ```markdown
    例: "このプロジェクトの現在のディレクトリ構造を分析し、React コンポーネントの再利用性を高めるために、どのように構造を見直すべきか提案してください。"
    ```

*   **Ask Mode**: 質問や情報収集に最適です。技術的な疑問、API の使い方、ライブラリの機能など、様々な情報を収集する際に使用します。
    ```markdown
    例: "React の最新バージョンの機能について、特にパフォーマンス向上に貢献する機能について教えてください。"
    ```

*   **Debug Mode**: 問題解決やデバッグに最適です。エラーメッセージの原因特定、コードの修正、テストの実行など、問題解決に関する作業を行う際に使用します。
    ```markdown
    例: "このエラーメッセージ「TypeError: Cannot read properties of undefined (reading 'map')」の原因を特定し、修正するためのコードを提案してください。"
    ```

### 1.2 モード切り替えの最適化

タスクによっては、複数のモードを組み合わせて使用することが効果的です。

*   タスクの性質に応じて、適切なモードを選択します。
*   複合的なタスクは、段階的にモードを切り替えることで、より効率的に実行できます。
    *   例: まず Architect Mode で設計を行い、Code Mode で実装を行う。
*   各モードの特性を活かした指示の出し方を意識します。
    *   例: Architect Mode では、抽象的な指示や設計に関する質問を行い、Code Mode では、具体的なコードの記述や修正を指示する。

## 2. ツール活用の最適化

Roo は、様々なツールを提供しており、これらのツールを効果的に活用することで、タスクの効率性と精度を向上させることができます。

### 2.1 ファイル操作系ツール

*   **read_file**: 既存のコードや設定ファイルの内容を分析する際に使用します。
    ```markdown
    - 大規模なファイルは避け、必要な部分のみを読み込むように指示します。
    - コンテキストを理解するために、段階的にファイルを読み込むように指示します。
    ```
    ```markdown
    例: "src/components/Button.tsx ファイルのコードを読み込み、Button コンポーネントの props の型定義を確認してください。"
    ```

*   **write_to_file**: 新しいファイルを作成したり、既存のファイルを完全に書き換える際に使用します。
    ```markdown
    - ファイルの完全な内容を一度に提供するように指示します。
    - 行数を正確にカウントするように指示します。
    ```
    ```markdown
    例: "src/utils/api.ts ファイルを作成し、指定された API エンドポイントからデータを取得する関数を実装してください。ファイルの内容は以下の通りです。"
    ```

*   **apply_diff**: 既存のファイルの特定の部分を修正する際に使用します。
    ```markdown
    - 修正する行番号を正確に指定します。
    - 既存のコードと厳密にマッチングするように指示します。
    ```
    ```markdown
    例: "src/components/Button.tsx ファイルの 10 行目から 15 行目のコードを、以下のコードに置き換えてください。"
    ```

### 2.2 検索・分析系ツール

*   **search_files**: コードベース全体を検索する際に使用します。特定のキーワード、コードパターン、または TODO コメントなどを検索できます。
    ```markdown
    - 検索に最適な正規表現を使用するように指示します。
    - 検索対象のファイルパターンを効果的に指定します（例：`*.ts`、`*.js`）。
    ```
    ```markdown
    例: "src ディレクトリ配下のすべての TypeScript ファイルを検索し、`TODO` コメントをすべて見つけてください。"
    ```

*   **list_code_definition_names**: コードの構造を把握する際に使用します。ファイル内のクラス、関数、変数などの定義名を一覧表示できます。
    ```markdown
    - モジュール間の依存関係を分析するために使用します。
    - リファクタリングの計画を立案するために使用します。
    ```
    ```markdown
    例: "src/components ディレクトリ配下のすべての TypeScript ファイルの、トップレベルのコード定義名を一覧表示してください。"
    ```

## 3. コンテキスト管理の最適化

Roo を効果的に使用するためには、コンテキストを適切に管理することが重要です。

### 3.1 環境情報の活用

Roo は、現在の作業環境に関する様々な情報を提供します。これらの情報を活用することで、より適切な指示を出すことができます。

*   **VSCode Visible Files の確認:** 現在開いているファイルを確認し、関連するファイルへの操作を指示します。
*   **開いているタブの把握:** 現在開いているタブを確認し、関連するファイルへの操作を指示します。
*   **現在の作業ディレクトリの理解:** 現在の作業ディレクトリを理解し、ファイルパスの指定などに活用します。

### 3.2 メモリ管理

Roo は、過去の会話履歴を記憶していますが、コンテキストサイズには制限があります。

*   コンテキストサイズを監視し、必要に応じてコンテキストをリフレッシュします。
*   重要情報を優先的に保持し、不要な情報は削除します。
*   タスクが複雑になる場合は、段階的に分割し、各段階でコンテキストを整理します。

## 4. タスク実行の最適化

### 4.1 段階的アプローチ

複雑なタスクを Roo に実行させる場合は、段階的なアプローチを採用することで、より正確で効率的な結果を得ることができます。

1.  **タスク分析:**
    *   目的を明確にします。
    *   必要なステップを特定します。
    *   依存関係を把握します。
2.  **実行計画:**
    *   使用するツールを選択します。
    *   実行順序を決定します。
    *   エラー処理の方法を準備します。
3.  **段階的実行:**
    *   1 ステップずつ実行し、結果を確認します。
    *   必要に応じて、計画を調整します。

### 4.2 エラー処理とリカバリー

Roo がエラーを発生させた場合、適切なエラー処理とリカバリー戦略を立てることが重要です。

*   エラーメッセージを注意深く解釈し、原因を特定します。
*   代替アプローチを準備します。
*   必要に応じて、ユーザーとの効果的なコミュニケーションを行い、追加の情報を求めます。

## 5. コミュニケーションの最適化

### 5.1 プロンプト構造

Roo への指示（プロンプト）は、明確で構造化された形式で記述することが重要です。

```markdown
<task>
具体的な指示
</task>

オプション:
- 優先順位
- 制約条件
- 期待される出力形式
```

*   `<task>` タグで囲まれた部分に、具体的な指示を記述します。
*   オプションとして、優先順位、制約条件、期待される出力形式などを指定します。

### 5.2 フィードバックの活用

Roo の回答に対して、積極的にフィードバックを提供することで、より正確で適切な結果を得ることができます。

*   ユーザーの意図を正確に理解しているか確認し、必要に応じて修正を提案します。
*   提案された修正を迅速に適用し、結果を確認します。
*   継続的な改善プロセスを維持し、Roo のパフォーマンスを向上させます。

## 6. MCP 操作の最適化

MCP (Model Context Protocol) を使用することで、Roo の機能をさらに拡張できます。

### 6.1 ツール利用

*   **use_mcp_tool**: MCP サーバーが提供するツールを利用します。
    ```markdown
    - 適切なサーバーとツールを選択します。
    - パラメータを正確に指定します。
    - 結果を適切に処理します。
    ```
    ```markdown
    例: "weather-server の get_forecast ツールを使用して、東京の天気予報を取得してください。"
    ```

### 6.2 リソースアクセス

*   **access_mcp_resource**: MCP サーバーが提供するリソースにアクセスします。
    ```markdown
    - リソース URI を正確に指定します。
    - レスポンスを効果的に活用します。
    ```
    ```markdown
    例: "weather-server の weather://tokyo/current リソースにアクセスして、現在の東京の天気情報を取得してください。"
    ```

## 7. プロジェクト固有の最適化

### 7.1 .clinerules の活用

`.clinerules` ファイルには、プロジェクト固有のルールやベストプラクティスが記述されています。

*   プロジェクト固有のルールを理解し、遵守します。
*   コミットメッセージの規約を遵守します。
*   文書化要件を遵守します。

### 7.2 チーム規約の遵守

チームで定められた規約を遵守することで、コードの品質と可読性を向上させることができます。

*   コーディング規約を遵守します。
*   コードレビュープロセスを尊重します。
*   ドキュメント規約を遵守します。

## 8. パフォーマンス最適化

Roo の応答時間とリソース使用量を最適化することで、より効率的な開発を行うことができます。

### 8.1 応答時間の最適化

*   必要最小限のツール使用を心がけます。
*   効率的なファイル操作を行います。
*   適切なバッチ処理を行います。

### 8.2 リソース使用の最適化

*   メモリ使用量を管理します。
*   コンテキストサイズを制御します。
*   適切なキャッシュ戦略を検討します。

## 9. セキュリティ考慮事項

Roo を使用する際には、セキュリティに関する考慮事項も重要です。

### 9.1 機密情報の取り扱い

*   環境変数を適切に使用し、機密情報をコードに直接記述しないようにします。
*   機密ファイルは、`.gitignore` などを使用して、バージョン管理から除外します。
*   セキュアな通信を確保します。

### 9.2 アクセス制御

*   適切な権限レベルを維持します。
*   セキュリティ境界を尊重します。
*   監査ログを維持します。

## 10. トラブルシューティング

Roo の使用中に問題が発生した場合、以下の手順でトラブルシューティングを行います。

### 10.1 一般的な問題

*   コンテキストの喪失: プロンプトが長すぎる、または複雑すぎる場合に発生することがあります。プロンプトを分割し、コンテキストを整理することで対応します。
*   ツールエラー: ツールが正しく動作しない場合は、エラーメッセージを確認し、原因を特定します。
*   依存関係の問題: 必要なライブラリがインストールされていない、またはバージョンが古い場合に発生することがあります。依存関係を適切に管理します。

### 10.2 回復戦略

*   バックアップの活用: 変更を適用する前に、必ずバックアップを作成します。
*   代替アプローチの適用: 問題が解決しない場合は、別のツールやアプローチを試します。
*   エスカレーションパスの把握: 問題が解決しない場合は、チームメンバーに相談します。

## 11. RooCode と AI プロバイダ間のやり取り

RooCode は、AI プロバイダ（例：OpenAI、Anthropic）と連携して、様々なタスクを実行します。RooCode は、ユーザーからの指示をプロンプトとして AI プロバイダに送信し、AI プロバイダからの応答を解析して、適切なツールを選択し、実行します。

*   **プロンプトの送信:** ユーザーからの指示は、RooCode によって、AI プロバイダが理解しやすいように、構造化されたプロンプトに変換されます。
*   **応答の解析:** AI プロバイダからの応答は、RooCode によって解析され、タスクの実行に必要な情報（例：ツール名、パラメータ）が抽出されます。
*   **ツールの選択と実行:** 解析された情報に基づいて、RooCode は適切なツールを選択し、実行します。
*   **結果のフィードバック:** ツールの実行結果は、ユーザーにフィードバックされます。

この一連のやり取りを通じて、RooCode は、AI の能力を活用して、様々なタスクを自動化し、開発者の生産性を向上させます。