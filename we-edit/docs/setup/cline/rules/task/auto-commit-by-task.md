# タスク完了時の自動コミットタスク

## 0. AI重要ルール

### 0.1 自動コミットの必須チェック

AIは以下のタイミングで必ず自動コミットの確認を行う：

1. attempt_completion使用前（最重要）
   - 結果の記述前に変更確認
   - コミット内容の準備
   - コミットコマンドの構築

2. 各ツール使用後
   - 変更の有無を確認
   - 変更があった場合はコミット検討
   - 関連する変更をグループ化

3. モード切り替え時
   - 未コミットの変更確認
   - 必要に応じてコミット実行
   - 新モードへの移行判断

### 0.2 コミット忘れ防止策

1. attempt_completion使用時の強制確認
   - result記述前に変更確認を義務付け
   - command部にコミットコマンドの記述を必須化
   - コミットなしの完了を禁止

2. 変更監視の仕組み
   - 各ツール使用後の変更確認
   - 定期的な状態チェック
   - 未コミット警告の表示

3. セーフティネット
   - モード切り替え時の確認
   - 長時間作業時の定期確認
   - エラー発生時の状態確認

### 0.3 コミット実行チェックリスト

タスク完了前に必ず以下の項目を確認：

```markdown
変更の確認:
- [ ] 変更されたファイルを特定したか
- [ ] 変更内容を確認したか
- [ ] 変更をグループ化したか

コミットの準備:
- [ ] コミットメッセージを作成したか
- [ ] git-workflow.mdの規約に準拠しているか
- [ ] プロンプト履歴を含めているか

attempt_completion:
- [ ] resultに結果を記述したか
- [ ] commandにコミットコマンドを含めたか
- [ ] 全ての変更が含まれているか
```

### 0.4 実行手順

1. 変更の確認
   - list_files で変更対象を確認
   - read_file で変更内容を確認
   - 関連する変更をグループ化

2. コミットの準備
   - コミットメッセージの作成
   - プロンプト履歴の整理
   - コミットコマンドの構築

3. attempt_completion の実行
   - 変更の最終確認
   - result と command の記述
   - ユーザーへの実行提案

## 1. 実行タイミング

### 1.1 通常のタスク完了時

1. attempt_completion使用時
   - 実行結果の記述
   - 変更ファイルの特定
   - コミットメッセージの作成

2. コマンド実行
   ```typescript
   <attempt_completion>
   <result>
   タスクの完了結果を記述
   </result>
   <command>
   git add [変更したファイル...] && git commit -m "[コミットメッセージ]"
   </command>
   </attempt_completion>
   ```

### 1.2 複数ファイル変更時

1. 変更内容の整理
   - 関連する変更のグループ化
   - 独立した変更の分離
   - コミット単位の決定

2. コミットメッセージの構造化
   - 変更の種類の明記
   - 影響範囲の記述
   - 詳細な説明の追加

## 2. コミットメッセージ作成

コミットメッセージは [git-workflow.md](docs/setup/cline/rules/git-workflow.md) の「コミットメッセージ規約」に準拠します。

### 2.1 主要な要素

1. 基本構造の遵守
   - 形式：`<type>(<scope>): <subject>`
   - 変更内容の詳細なbody
   - プロンプト履歴の追加

2. 内容の品質確保
   - Conventional Commits準拠のtype
   - 明確な影響範囲の記述
   - 簡潔で理解しやすい説明

3. 日本語による記述
   - メッセージ本文
   - プロンプト履歴
   - 補足説明

## 3. エラー処理

### 3.1 コミット失敗時の対応

1. エラー内容の確認
2. 修正案の提示
3. 再実行の提案

### 3.2 競合発生時の対応

1. 競合内容の分析
2. 解決手順の提案
3. ユーザーへの確認

### 3.3 不適切なコミット時

1. 問題の特定
2. 修正コミットの提案
3. 再構成の検討